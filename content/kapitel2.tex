% !TeX spellcheck = de_DE

\chapter{Methodology}
\label{chap:k2}

The following sections describe the principles of 3D lane marking reconstruction method proposed in this thesis. 
% with respect to their location in the processing chain (Fig.1.).

Section~\ref{sec:2.1.LineExtraction} describes how lane markings are extracted.
Section~\ref{sec:2.2.Geometry} introduces the geometric properties of aerial images and their mathematical models, including collinearity equation and lens distortion correction. 
Section~\ref{sec:2.3.LineFitting} describes the principle of line fitting as well as line equation in two-point form.
Modeled through non-linear least-squares adjustment, section~\ref{sec:2.4} elaborates the usage of line fitting on 3D lane marking reconstruction, which is the key approach to solve the non-textured-neighboring quasi-infinite line reconstruction problem.




Fig. 1. Processing chain


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Lane markings Extraction}
\label{sec:2.1.LineExtraction}
[This is done with Halcon11/C...]
with subpixel precision
Each extracted line is rasterized as a set of points in image coordinate (with … precision).
line (2D) -> a set of points (2D) , in image space
% http://www.mvtec.com/doc/halcon/11/en/lines_gauss.html
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Geometric Properties of Aerial Photographs}
\label{sec:2.2.Geometry}

This section describes the geometric model of the projection of 3D points into the image generated by a real camera. We first restrict the discussion in subsection~\ref{subsec:2.2.1.Collinearity} to central perspective projection where the collinearity equation originate from. We then model deviations from this model, addressing real cameras with imperfect lenses, in subsection~\ref{subsec:2.2.2.LensDistortion}.

\subsection{Collinearity Equation}
\label{subsec:2.2.1.Collinearity}
We assume frame photography, i.e. photographs exposed in one instant, and assume central projection model, i.e. cameras who have a single viewpoint and a planar sensor and being straight line-preserving. Collinearity indicates the condition that the image point (on the sensor plate of the camera), the observed point (on the object) and the projection center of the camera were aligned at the moment the picture was taken. Every measured point leads to two collinearity equations, describing transformations from object space to image coordinates:
\begin{equation} %\label{eq:2.3}
\begin{split}
x - x_0 = -c \dfrac {R_{11}(X-X_0) + R_{21}(Y-Y_0) + R_{31}(Z-Z_0)} {R_{13}(X-X_0) + R_{23}(Y-Y_0) + R_{33}(Z-Z_0)} \\
y - y_0 = -c \dfrac {R_{12}(X-X_0) + R_{22}(Y-Y_0) + R_{32}(Z-Z_0)} {R_{13}(X-X_0) + R_{23}(Y-Y_0) + R_{33}(Z-Z_0)}
\end{split}
\end{equation}
where\newline
$(x, y)$: image coordinates of the point \newline
$(x_0, y_0)$: image coordinates of principal point \newline
$c$: principal distance \newline
$(X, Y, Z)$: object coordinates of the point \newline
$(X_0, Y_0, Z_0)$: object coordinates of projection center \newline
$R_{11},...,R_{33}$: elements of the rotation matrix R (orthogonal 3$\times$3-matrix from object space to image space, with 3 independent angles $\omega$, $\phi$ and $\kappa$)

The exterior orientations: $X_0$, $Y_0$, $Z_0$, $\omega$, $\phi$, $\kappa$ as well as the interior orientations: $x_0$, $y_0$, $c$ are the bundle-adjusted, known elements in this work.
%The image coordinates $x,y$ are the measurements.

\subsection{Lens Distortion Correction}
\label{subsec:2.2.2.LensDistortion}

As real cameras generally only approximate the perspective camera model, lens distortion correction can be additionally included in the collinearity model, attempting to correct the position of image features such that they obey the perspective model with sufficient accuracy.[W. Förstner et al. 2016] 

Varies models for lens distortion ...

A subset of a physical distortion model[] is chosen for...
Assuming $x$ and $y$ to be the distorted image coordinates, the corrections $\Delta x$ and $\Delta y$ are then calculated by the following equations
\begin{equation} %\label{eq:2.2}
\begin{split}
\Delta x &= x_p + A_1x_*(r^2-R_0^2) + A_2x_*(r^4-R_0^4) + B_1(r^2+2x_*^2) + B_22x_*y+C_2y \\
\Delta y &= y_p + A_1y  (r^2-R_0^2) + A_2y  (r^4-R_0^4) + B_1(r^2+2y^2)   + B_22x_*y
\end{split}
\end{equation}
with $r=\sqrt{x_*^2+y^2}$ and $x_*=\dfrac{x}{C_1}$. The undistorted image coordinates $x\prime$ and $y\prime$ are then calculated by $x\prime=x+\Delta x$ and $y\prime=y+\Delta y$. [F. Kurz et al. 2012] 

%This allows us to reconstruct the viewing rays from the corresponding set of image points.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Line Fitting}
\label{sec:2.3.LineFitting}

Line fitting is the process of constructing a infinite straight line that has the best fit to a 2D dataset. One of the approaches is linear regression, as presented in subsection~\ref{subsec:2.3.1.LinearRegression}, which attempts to model the relationship between two variables by fitting a linear equation to observed data. For later combination with collinearity equation, we aim to fit the line equation in two-point form to the extracted lines from section~\ref{sec:2.1.LineExtraction} in forms of sets of points in image space. %This non-linear line equation is introduced in subsection~\ref{subsec:2.3.2.LineEquaTPform}.
For such purpose, a non-linear least-squares adjustment model is derived in subsection~\ref{subsec:2.3.2.NonLinear}. It is further expanded into a mixed model to perform orthogonal fit in subsection~\ref{subsec:2.3.3.MixedModel}.

\subsection{Linear Regression Model}
\label{subsec:2.3.1.LinearRegression}
Given a data set $\{x_i,y_i\}^n_{i=1}$ of $n$ points on a 2D plane, a linear regression model assumes that the relationship between the dependent variable $y_i$ and the regressors $x_i$ is linear. This relationship is modeled through a error variable $e_{y_i}$ -an unobserved random variable that adds noise to the linear relationship between the dependent variable and regressors.
Thus the model takes the form:
\begin{equation} %\label{eq:2.1}
y_i - e_{y_i} = a_0 + a_1x_i
\end{equation}
%https://en.wikipedia.org/wiki/Linear_regression#Assumptions

\subsection{Non-linear Least-Squares Adjustment Model}
\label{subsec:2.3.2.NonLinear}

Line Equation in two-point form:
\begin{equation} %\label{eq:2.4}
y_i-y_1 = \dfrac{(y_2-y_1)}{(x_2-x_1)}\times(x_i-x_1)
\end{equation}
where two points $(x_1,y_1)$ and $(x_2,y_2)$ define the infinite line with $x_2\neq x_1$ and $(x_i,y_i)$ is any point on the line.

Rewriting equation???, the observation equation is 
\begin{equation} %\label{eq:2.3}
y_i = \dfrac{(y_2-y_1)}{(x_2-x_1)}\times x_i+(y_1-\dfrac{(y_2-y_1)}{(x_2-x_1)}\times x_1) + e_{y_i}
\end{equation}


\subsection{Mixed Model (Gauss-Helmert Model)}
\label{subsec:2.3.3.MixedModel}

In the case with inconsistencies $e_{x_i}$ and $e_{y_i}$ in both observations $x_i$ and $y_i$, the model takes the form:
\begin{equation} %\label{eq:2.2}
\begin{split}
y_i - e_{y_i} &= a_0 + a_1(x_i-e_{x_i}) = a_0 + a_1\bar{x_i}\\
x_i-e_{x_i} &= \bar{x_i}
\end{split}
\end{equation}
It is known as the mixed model or Gauss-Helmert model.






In this work, orthogonal regression model is presented based on line equation of two-point form.





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Least-Squares Adjustment Model}
\label{sec:2.4}



%\begin{equation}\label{eq:test}
%a = b + c.
%\end{equation}

%\begin{equation}
%a = b + c. \tag{\ref{eq:test} revisited}
%\end{equation}



